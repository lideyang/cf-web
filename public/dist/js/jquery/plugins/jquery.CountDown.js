define(function(require,exports,module){var e=require("jquery");!function($){function e(e,t){var s={time:60,mobile:"",start:!1,isMobile:!1,isSeed:!1,isMsg:!1,type:"GET",Msg:"验证码已发送，请注意查收",url:basePath+"/phonecode.json",mockUrl:"/account/phone",type:"POST",isCallBack:!1,isClick:!0,isClear:!1,isUpdateDate:!1,beforeClick:!1,tokenId:!1,callBack:!1,beforeSeed:!1,successDataCode:"200",data:{captchaType:"FIND_PAY_PWD",phone:$("#mobile").val()}},a=this;$(t).prop("disabled",!1);var n=a.defs=$.extend(!0,s,e);a.time=0,a.Tid=0,a.seedBtn=$(t),a.btnText=a.seedBtn.val()?a.seedBtn.val():a.seedBtn.text(),a.defs.start&&a.init(),a.defs.isClick&&a.seedBtn.on("click",function(){if(!(a.time>0)){if(n.beforeClick&&"function"==typeof n.beforeClick&&n.beforeClick(),n.isMobile){var e=$(n.isMobile).val();if(!a.checkMobile(e))return void layer.msg("手机号码不正确",{icon:2});n.data.phone=e}a.seed()}})}e.prototype={init:function(){var e=this;e.defs.isSeed?this.seed():(e.time=e.defs.time,e.Tid=setInterval(function(){e.CountDownDo()},1e3))},seed:function(){var e=this;if(e.defs.tokenId){var t=$(e.defs.tokenId).val();for(var s in e.defs.data){var a=e.defs.data[s];if("formToken"==a.name){a.value=t;break}}}e.defs.beforeSeed&&e.defs.beforeSeed,e.defs.isClear&&$(e.defs.isClear).val(""),e.defs.isUpdateDate&&(e.defs.data=$(e.defs.isUpdateDate).serializeArray()),$.ajax({type:e.defs.type,url:e.defs.url,mockUrl:e.defs.mockUrl,data:e.defs.data,dataType:"JSON",async:!1,cache:!1,type:e.defs.type,success:function(t,s,a){if(e.defs.tokenId){var n=a.getResponseHeader("formToken");$(e.defs.tokenId).val(n);for(var i in e.defs.data){var d=e.defs.data[i];if("formToken"==d.name){d.value=n;break}}}"200"==t.code||"order-pay-check-code-confirm"==t.code||"bank-card-agreement-confirm"==t.code?(e.defs.isMsg?e.seedBtn.parent().find(".alertText").css("display","inline").html('<em class="miss"></em><label class="error miss">'+e.defs.Msg+"</label>").delay(3e3).fadeOut():e.seedBtn.parent().find(".alertText").css("display","none").html(""),e.time=e.defs.time,e.CountDownDo(),e.Tid=setInterval(function(){e.CountDownDo()},1e3)):(e.defs.isCallBack?layer.msg(t[e.defs.isCallBack],{icon:5}):layer.msg("发送失败,请稍后再试。",{icon:5}),e.defs.isMsg&&("500"!=t.code?e.seedBtn.parent().find(".alertText").html('<em class="miss"></em><label class="error">'+t.message+"</label>"):e.seedBtn.parent().find(".alertText").css("display","none").html("")))},error:function(){layer.msg("验证码发送失败,请稍后再试。",{icon:5})}})},CountDownDo:function(){var e=this;e.time>1?(e.time-=1,e.seedBtn.val("还剩"+e.time+"秒").text("还剩"+e.time+"秒").removeClass("btn-sms").attr("disabled","disabled").addClass("btnClose")):(e.time=0,clearInterval(e.Tid),e.seedBtn.val(e.btnText).text(e.btnText),e.seedBtn.addClass("btn-sms").removeAttr("disabled").removeClass("btnClose"))},checkMobile:function(e){var t=/(^1\d{10}$)|(^1\d{2}\*\*\*\*\d{4}$)/;return!!t.test(e)},setDefaults:function(e){this.defs=$.extend(!0,this.defs,e)}},$.fn.CountDown=function(t,s){return this.each(function(){var a=$(this),n=a.data("CountDown");if("string"==typeof t)n[t](s);else{if(!t.isClick)return void a.data("CountDown",n=new e(t,a));n||a.data("CountDown",n=new e(t,a))}}),this}}(e)});