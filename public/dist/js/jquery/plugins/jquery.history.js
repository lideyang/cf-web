define(function(require,exports,module){function History(t){this.limit=10,this.key=t||"y_his",this.jsonData=null,this.cacheTime=2400}History.prototype={constructor:History,addCookie:function(t,i,s,e){e=e||{};var o=t+"="+escape(i);if(void 0!=s&&s>0){var n=new Date;n.setTime(n.getTime()+3600*s*1e3),o=o+"; expires="+n.toUTCString()}var a=e.path?"; path="+e.path:"",r=e.domain?"; domain="+e.domain:"",h=e.secure?"; secure":"";document.cookie=o+a+r+h},getCookie:function(t){for(var i=document.cookie,s=i.split(";"),e="",o="",n=0;n<s.length;n++)if(o=s[n].split("="),o[0].replace(/\s+/g,"")==t){e=unescape(o[1]);break}return e.toString()},deleteCookie:function(t){var i=new Date;i.setTime(i.getTime()-1e4),document.cookie=t+"=''; expires="+i.toUTCString()},initRow:function(t,i,s){return'{"title":"'+t+'", "link":"'+i+'", "other":"'+s+'"}'},parse2Json:function(jsonStr){var json=[];try{json=JSON.parse(jsonStr)}catch(e){json=eval(jsonStr)}return json},add:function(t,i,s){var e=this.getCookie(this.key);if(""!=e){this.jsonData=this.parse2Json(e);for(var o=0;o<this.jsonData.length;o++)if(i==this.jsonData[o].link||t==this.jsonData[o].title)return!1;e="["+this.initRow(t,i,s)+",";for(var n=0;n<this.limit-1&&void 0!=this.jsonData[n];n++)e+=this.initRow(this.jsonData[n].title,this.jsonData[n].link,this.jsonData[n].other)+",";e=e.substring(0,e.lastIndexOf(",")),e+="]"}else e="["+this.initRow(t,i,s)+"]";this.jsonData=this.parse2Json(e),this.addCookie(this.key,e,this.cacheTime)},getList:function(){if(null!=this.jsonData)return this.jsonData;var t=this.getCookie(this.key);return""!=t&&(this.jsonData=this.parse2Json(t)),this.jsonData},delItem:function(t){var i=this.getCookie(this.key);if(""!=i){this.jsonData=this.parse2Json(i);for(var s=0;s<this.jsonData.length;s++)t==this.jsonData[s].title&&delete this.jsonData[s];var e="[";for(var o in this.jsonData){var n=this.jsonData[o];e+=this.initRow(n.title,n.link,n.other)+","}e=e.substring(0,i.lastIndexOf(",")),e+="]",console.log(e),this.clearHistory(),this.addCookie(this.key,e,this.cacheTime)}},clearHistory:function(){this.deleteCookie(this.key),this.jsonData=null}},window.History=History});